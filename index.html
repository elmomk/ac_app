<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AC Controller</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .ac-card {
            background-color: #2c2c2c;
            border-radius: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            padding: 2rem;
            width: 100%;
            max-width: 400px;
            border: 1px solid #4a4a4a;
        }

        .control-button {
            border-radius: 9999px;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s ease-in-out;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.4);
        }

        .control-button:active:not(:disabled) {
            transform: scale(0.95);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.6);
        }

        .button-text {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .control-button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
    </style>
</head>

<body>

    <div id="ac-container" class="ac-card flex flex-col items-center">
        <!-- Main Display -->
        <div class="w-full text-center mb-6">
            <div class="text-4xl font-bold mb-2" id="temp-display">--¬∞C</div>
            <div class="text-lg font-medium text-gray-400" id="status-text">OFF</div>
        </div>

        <!-- AC State Icons -->
        <div class="flex justify-around w-full max-w-sm mb-8">
            <div id="mode-icon-container" class="flex flex-col items-center opacity-30 transition-opacity">
                <span class="text-4xl" id="mode-icon"></span>
                <span class="mt-1 text-sm text-gray-400" id="mode-text"></span>
            </div>
            <div id="fan-icon-container" class="flex flex-col items-center opacity-30 transition-opacity">
                <span class="text-4xl" id="fan-icon"></span>
                <span class="mt-1 text-sm text-gray-400" id="fan-text"></span>
            </div>
        </div>

        <!-- Power Button -->
        <div class="mb-8">
            <button id="power-btn" class="control-button bg-gray-600 hover:bg-red-500 transition-colors">
                <span id="power-icon" class="text-2xl"></span>
            </button>
        </div>

        <!-- Temperature Controls -->
        <div class="flex items-center space-x-4 mb-8">
            <button id="temp-down-btn" class="control-button bg-gray-700 hover:bg-gray-600 transition-colors">
                <span class="text-2xl text-white">-</span>
            </button>
            <div class="text-xl font-medium">Temperature</div>
            <button id="temp-up-btn" class="control-button bg-gray-700 hover:bg-gray-600 transition-colors">
                <span class="text-2xl text-white">+</span>
            </button>
        </div>

        <!-- Mode and Fan Speed Controls -->
        <div class="flex justify-between w-full max-w-xs">
            <button id="mode-btn" class="flex flex-col items-center p-3 rounded-xl bg-gray-700 hover:bg-gray-600 transition-colors">
                <span class="text-3xl mb-1" id="control-mode-icon"></span>
                <span class="button-text">Mode</span>
            </button>
            <button id="fan-btn" class="flex flex-col items-center p-3 rounded-xl bg-gray-700 hover:bg-gray-600 transition-colors">
                <span class="text-3xl mb-1" id="control-fan-icon"></span>
                <span class="button-text">Fan</span>
            </button>
        </div>
    </div>

    <script>
        // State variables for the simulated AC
        let acState = {
            isOn: false,
            temperature: 24, // in Celsius
            mode: 'Cool',
            fanSpeed: 'Medium'
        };

        // A variable to track if an API request is in progress
        let isSending = false;

        // UI elements
        const tempDisplay = document.getElementById('temp-display');
        const statusText = document.getElementById('status-text');
        const powerBtn = document.getElementById('power-btn');
        const tempUpBtn = document.getElementById('temp-up-btn');
        const tempDownBtn = document.getElementById('temp-down-btn');
        const modeBtn = document.getElementById('mode-btn');
        const fanBtn = document.getElementById('fan-btn');
        const acContainer = document.getElementById('ac-container');
        const modeIconContainer = document.getElementById('mode-icon-container');
        const fanIconContainer = document.getElementById('fan-icon-container');
        const modeIcon = document.getElementById('mode-icon');
        const modeText = document.getElementById('mode-text');
        const fanIcon = document.getElementById('fan-icon');
        const fanText = document.getElementById('fan-text');
        const powerIcon = document.getElementById('power-icon');
        const controlModeIcon = document.getElementById('control-mode-icon');
        const controlFanIcon = document.getElementById('control-fan-icon');

        // All interactive buttons
        const allButtons = [powerBtn, tempUpBtn, tempDownBtn, modeBtn, fanBtn];

        // Function to render the current state to the UI
        function renderState() {
            // Disable buttons if a command is being sent
            allButtons.forEach(btn => btn.disabled = isSending);

            if (isSending) {
                statusText.textContent = 'Sending...';
                return;
            }

            if (acState.isOn) {
                // AC is ON
                acContainer.classList.add('bg-gray-800');
                acContainer.classList.remove('bg-gray-900');
                tempDisplay.textContent = `${acState.temperature}¬∞C`;
                statusText.textContent = 'ON';
                powerIcon.textContent = '‚ö°'; // Power icon
                modeIconContainer.classList.remove('opacity-30');
                fanIconContainer.classList.remove('opacity-30');
                powerBtn.classList.add('bg-red-500');
                powerBtn.classList.remove('bg-gray-600');
            } else {
                // AC is OFF
                acContainer.classList.add('bg-gray-900');
                acContainer.classList.remove('bg-gray-800');
                tempDisplay.textContent = '--¬∞C';
                statusText.textContent = 'OFF';
                powerIcon.textContent = '‚ö™'; // Off icon
                modeIconContainer.classList.add('opacity-30');
                fanIconContainer.classList.add('opacity-30');
                powerBtn.classList.remove('bg-red-500');
                powerBtn.classList.add('bg-gray-600');
            }

            // Update mode display
            switch (acState.mode) {
                case 'Cool':
                    modeIcon.textContent = '‚ùÑÔ∏è'; // Snowflake
                    modeText.textContent = 'Cool';
                    controlModeIcon.textContent = '‚ùÑÔ∏è';
                    break;
                case 'Heat':
                    modeIcon.textContent = 'üî•'; // Fire
                    modeText.textContent = 'Heat';
                    controlModeIcon.textContent = 'üî•';
                    break;
                case 'Fan':
                    modeIcon.textContent = 'üí®'; // Wind
                    modeText.textContent = 'Fan';
                    controlModeIcon.textContent = 'üí®';
                    break;
            }

            // Update fan speed display
            switch (acState.fanSpeed) {
                case 'Low':
                    fanIcon.textContent = 'üå¨Ô∏è';
                    fanText.textContent = 'Low';
                    controlFanIcon.textContent = 'üå¨Ô∏è';
                    break;
                case 'Medium':
                    fanIcon.textContent = 'üí®';
                    fanText.textContent = 'Medium';
                    controlFanIcon.textContent = 'üí®';
                    break;
                case 'High':
                    fanIcon.textContent = 'üå™Ô∏è';
                    fanText.textContent = 'High';
                    controlFanIcon.textContent = 'üå™Ô∏è';
                    break;
            }
        }

        // FAKE API function to simulate sending a command to the Raspberry Pi
        async function sendCommand(newState) {
            isSending = true;
            renderState();

            // The actual API URL to your FastAPI server
            const apiUrl = 'http://localhost:8000/api/set-state';

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newState)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                console.log('API Response:', data);

                // If the "API call" is successful, update the local state
                acState = newState;

            } catch (error) {
                console.error('Failed to send command to AC:', error);
                // Handle the error visually, e.g., show an error message on the UI
                statusText.textContent = 'Connection Error';
            } finally {
                isSending = false;
                renderState();
            }
        }

        // Functions to handle button clicks, now calling the async API function
        function togglePower() {
            const newState = { ...acState,
                isOn: !acState.isOn
            };
            sendCommand(newState);
        }

        function changeTemperature(delta) {
            if (acState.isOn) {
                const newTemp = acState.temperature + delta;
                if (newTemp >= 16 && newTemp <= 30) {
                    const newState = { ...acState,
                        temperature: newTemp
                    };
                    sendCommand(newState);
                }
            }
        }

        function changeMode() {
            if (acState.isOn) {
                const modes = ['Cool', 'Heat', 'Fan'];
                const currentIndex = modes.indexOf(acState.mode);
                const nextIndex = (currentIndex + 1) % modes.length;
                const newState = { ...acState,
                    mode: modes[nextIndex]
                };
                sendCommand(newState);
            }
        }

        function changeFanSpeed() {
            if (acState.isOn) {
                const speeds = ['Low', 'Medium', 'High'];
                const currentIndex = speeds.indexOf(acState.fanSpeed);
                const nextIndex = (currentIndex + 1) % speeds.length;
                const newState = { ...acState,
                    fanSpeed: speeds[nextIndex]
                };
                sendCommand(newState);
            }
        }

        // Event listeners for buttons
        powerBtn.addEventListener('click', togglePower);
        tempUpBtn.addEventListener('click', () => changeTemperature(1));
        tempDownBtn.addEventListener('click', () => changeTemperature(-1));
        modeBtn.addEventListener('click', changeMode);
        fanBtn.addEventListener('click', changeFanSpeed);

        // Initial render
        renderState();
    </script>
</body>

</html>

